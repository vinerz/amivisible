{"version":3,"sources":["bundle.min.js"],"names":["AMIVisible","scrollTimer","lastScrollFireTime","lastScrollPos","EventTrigger","targets","minScrollTime","window","CustomEvent","event","params","bubbles","cancelable","detail","undefined","evt","document","createEvent","initCustomEvent","prototype","Event","visibleY","el","rect","getBoundingClientRect","top","height","parentNode","bottom","body","console","log","innerHeight","throttle","now","Date","getTime","checkElements","scrollTop","setTimeout","pos","_checkSingleElement","element","lastState","fEvent","enable_bubbling","dispatchEvent","i","len","length","addEventListener","monitor","options","force_process","obj","push","set","optionName","newValue","Number"],"mappings":"AAAA,GAAIA,YAAa,WACf,GACIC,GAAaC,EAAoBC,EACnCC,EAFEC,KACgDC,EAAgB,EAGlC,mBAAvBC,QAAOC,aAChBJ,EAAe,SAASK,EAAOC,GAC7BA,EAASA,IACPC,SAAS,EACTC,YAAY,EACZC,OAAQC,OAEV,IAAIC,GAAMC,SAASC,YAAY,cAE/B,OADAF,GAAIG,gBAAgBT,EAAOC,EAAOC,QAASD,EAAOE,WAAYF,EAAOG,QAC9DE,GAGTX,EAAae,UAAYZ,OAAOa,MAAMD,WAEtCf,EAAeG,OAAOC,WAGxB,IAAIa,GAAW,SAASC,GACtB,GAAIC,GAAOD,EAAGE,wBACZC,EAAMF,EAAKE,IACXC,EAASH,EAAKG,OACdJ,EAAKA,EAAGK,UAEV,GAAG,CAGD,GAFAJ,EAAOD,EAAGE,wBAENC,EAAMF,EAAKK,OACb,OAAO,CAIT,IAAKH,EAAMC,GAAWH,EAAKE,IACzB,OAAO,CAIT,IAAGH,GAAMN,SAASa,KAChB,KAGFP,GAAKA,EAAGK,iBACDL,GAAMN,SAASa,KAIxB,OADAC,SAAQC,IAAIN,EAAMC,GACXD,GAAOlB,OAAOyB,aAAgBP,EAAMC,EAAU,GAGnDO,EAAW,WACb,GAAIC,IAAM,GAAIC,OAAOC,SAEhBnC,KACCiC,EAAMhC,EAAsB,EAAII,IAClC+B,IACAnC,EAAqBgC,EACrB/B,EAAgBa,SAASa,KAAKS,WAGhCrC,EAAcsC,WAAW,WACvBtC,EAAc,KACdC,GAAqB,GAAIiC,OAAOC,SAChC,IAAII,GAAMxB,SAASa,KAAKS,SAEpBE,KAAQrC,GACVkC,IAGFlC,EAAgBqC,GACflC,KAIHmC,EAAsB,SAASnB,GACjC,GAAID,EAASC,EAAGoB,UACd,GAAqB,YAAjBpB,EAAGqB,UAAyB,CAC9B,GAAIC,GAAS,GAAIxC,GAAa,UAC5BO,QAASW,EAAGuB,gBACZjC,YAAY,GAEdU,GAAGoB,QAAQI,cAAcF,GACzBtB,EAAGqB,UAAY,eAGjB,IAAqB,cAAjBrB,EAAGqB,UAA2B,CAChC,GAAIC,GAAS,GAAIxC,GAAa,aAC5BO,QAASW,EAAGuB,gBACZjC,YAAY,GAEdU,GAAGoB,QAAQI,cAAcF,GACzBtB,EAAGqB,UAAY,cAKjBN,EAAgB,WAClB,IAAK,GAAIU,GAAI,EAAGC,EAAM3C,EAAQ4C,OAAQF,EAAIC,EAAKD,IAC7CN,EAAoBpC,EAAQ0C,IAOhC,OAHAxC,QAAO2C,iBAAiB,SAAUjB,GAClC1B,OAAO2C,iBAAiB,SAAUjB,IAGhCkB,QAAS,SAAS7B,EAAI8B,GAQpB,GAPKA,IACHA,MAGFA,EAAQC,cAAgBD,EAAQC,gBAAiB,EACjDD,EAAQP,gBAAkBO,EAAQP,kBAAmB,EAEjDvB,EAAI,CACN,GAAIgC,IACFZ,QAASpB,EACTqB,UAAW,KACXE,gBAAiBO,EAAQP,gBAE3BxC,GAAQkD,KAAKD,GAETF,EAAQC,eACVZ,EAAoBa,KAI1BE,IAAK,SAASC,EAAYC,GACL,oBAAfD,IACFnD,EAAgBqD,OAAOD","file":"bundle.min.js","sourcesContent":["var AMIVisible = (function() {\n  var targets = [];\n  var scrollTimer, lastScrollFireTime, lastScrollPos, minScrollTime = 90,\n    EventTrigger;\n\n  if (typeof window.CustomEvent !== 'function') {\n    EventTrigger = function(event, params) {\n      params = params || {\n        bubbles: false,\n        cancelable: false,\n        detail: undefined\n      };\n      var evt = document.createEvent('CustomEvent');\n      evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n      return evt;\n    };\n\n    EventTrigger.prototype = window.Event.prototype;\n  } else {\n    EventTrigger = window.CustomEvent;\n  }\n\n  var visibleY = function(el) {\n    var rect = el.getBoundingClientRect(),\n      top = rect.top,\n      height = rect.height,\n      el = el.parentNode;\n\n    do {\n      rect = el.getBoundingClientRect();\n\n      if (top > rect.bottom) {\n        return false;\n      }\n\n      // Check if the element is out of view due to a container scrolling\n      if ((top + height) <= rect.top) {\n        return false;\n      }\n\n      // fix for monitoring elements that are direct children of body\n      if(el == document.body) {\n        break;\n      }\n\n      el = el.parentNode;\n    } while (el != document.body);\n\n    // Check its within the document Viewport\n    console.log(top + height);\n    return top <= window.innerHeight && (top + height) > 0;\n  };\n\n  var throttle = function() {\n    var now = new Date().getTime();\n\n    if (!scrollTimer) {\n      if (now - lastScrollFireTime > (3 * minScrollTime)) {\n        checkElements();\n        lastScrollFireTime = now;\n        lastScrollPos = document.body.scrollTop;\n      }\n\n      scrollTimer = setTimeout(function() {\n        scrollTimer = null;\n        lastScrollFireTime = new Date().getTime();\n        var pos = document.body.scrollTop;\n\n        if (pos !== lastScrollPos) {\n          checkElements();\n        }\n\n        lastScrollPos = pos;\n      }, minScrollTime);\n    }\n  };\n\n  var _checkSingleElement = function(el) {\n    if (visibleY(el.element)) {\n      if (el.lastState !== 'visible') {\n        var fEvent = new EventTrigger('appear', {\n          bubbles: el.enable_bubbling,\n          cancelable: true\n        });\n        el.element.dispatchEvent(fEvent);\n        el.lastState = 'visible';\n      }\n    } else {\n      if (el.lastState !== 'invisible') {\n        var fEvent = new EventTrigger('disappear', {\n          bubbles: el.enable_bubbling,\n          cancelable: true\n        });\n        el.element.dispatchEvent(fEvent);\n        el.lastState = 'invisible';\n      }\n    }\n  };\n\n  var checkElements = function() {\n    for (var i = 0, len = targets.length; i < len; i++) {\n      _checkSingleElement(targets[i]);\n    }\n  }\n\n  window.addEventListener('scroll', throttle);\n  window.addEventListener('resize', throttle);\n\n  return {\n    monitor: function(el, options) {\n      if (!options) {\n        options = {};\n      }\n\n      options.force_process = options.force_process || false;\n      options.enable_bubbling = options.enable_bubbling || false;\n\n      if (el) {\n        var obj = {\n          element: el,\n          lastState: null,\n          enable_bubbling: options.enable_bubbling\n        };\n        targets.push(obj);\n\n        if (options.force_process) {\n          _checkSingleElement(obj);\n        }\n      }\n    },\n    set: function(optionName, newValue) {\n      if (optionName === 'throttle_window') {\n        minScrollTime = Number(newValue);\n      }\n    }\n  };\n})();\n"],"sourceRoot":"/source/"}